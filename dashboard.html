<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memoria: Dashboard de Servidores</title>
    <style>
        /* --- ESTILOS CSS --- */
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg-light: #f8f9fa;
            --text: #333;
            --code-bg: #282c34;
            --code-text: #abb2bf;
            --error-bg: #ffebee;
            --error-border: #ef5350;
            --success-bg: #e8f5e9;
            --success-border: #66bb6a;
            --warn-bg: #fff3e0;
            --warn-border: #ffb74d;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            color: var(--text);
        }

        /* Men√∫ Lateral */
        nav {
            width: 280px;
            background-color: var(--primary);
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: fixed;
            height: 100%;
        }

        nav h2 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        nav a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 4px;
            transition: all 0.3s;
        }

        nav a:hover, nav a.active {
            background-color: var(--accent);
            color: white;
            padding-left: 15px;
        }

        .home-link {
            background-color: rgba(0,0,0,0.2);
            margin-bottom: 15px;
            font-weight: bold;
            color: #fff;
        }

        /* Contenido Principal */
        main {
            margin-left: 280px;
            padding: 40px;
            flex: 1;
            overflow-y: auto;
            background-color: white;
            scroll-behavior: smooth;
        }

        section {
            margin-bottom: 60px;
            max-width: 900px;
        }

        h1 { font-size: 2.5rem; color: var(--primary); margin-bottom: 10px; }
        h2 { font-size: 1.8rem; color: var(--primary); border-bottom: 2px solid var(--bg-light); padding-bottom: 10px; margin-top: 40px;}
        h3 { font-size: 1.3rem; color: var(--accent); margin-top: 20px; }
        p, li { line-height: 1.6; font-size: 1.05rem; }

        /* Tarjetas de Error/Soluci√≥n */
        .troubleshooting-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .error-header {
            background-color: var(--error-bg);
            border-left: 5px solid var(--error-border);
            padding: 10px 20px;
            font-weight: bold;
            color: #c62828;
            display: flex;
            align-items: center;
        }
        
        .warn-header {
            background-color: var(--warn-bg);
            border-left: 5px solid var(--warn-border);
            padding: 10px 20px;
            font-weight: bold;
            color: #e65100;
        }

        .solution-body {
            background-color: var(--success-bg);
            border-left: 5px solid var(--success-border);
            padding: 15px 20px;
        }

        .cause { padding: 10px 20px; background: white; border-left: 5px solid #ccc; font-style: italic;}

        /* Bloques de C√≥digo */
        pre {
            background-color: var(--code-bg);
            color: var(--code-text);
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        code { font-family: inherit; }
        
        .inline-code {
            background-color: #eee;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: monospace;
            color: #d63384;
        }

        /* Footer */
        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #888;
        }

        @media (max-width: 768px) {
            body { flex-direction: column; }
            nav { width: 100%; height: auto; position: relative; }
            main { margin-left: 0; padding: 20px; }
        }
    </style>
</head>
<body>

    <nav>
        <a href="index.html" class="home-link">‚¨Ö Volver al Dashboard</a>

        <h2>üìò Memoria Proyecto</h2>
        <a href="#intro" class="nav-link">1. Introducci√≥n</a>
        <a href="#metodologia" class="nav-link">2. Metodolog√≠a</a>
        <a href="#errores" class="nav-link">3. Errores y Soluciones</a>
        <a href="#tecnica" class="nav-link">4. Implementaci√≥n T√©cnica</a>
        <a href="#conclusion" class="nav-link">5. Conclusi√≥n</a>
    </nav>

    <main>
        
        <section id="intro">
            <h1>Dashboard de Control de Servidores</h1>
            <p><strong>Alumno:</strong> [Tu Nombre Aqu√≠]</p>
            <p><strong>Asignatura:</strong> Implantaci√≥n de Sistemas Operativos</p>
            <hr>
            
            <h2>1. Introducci√≥n y Objetivos</h2>
            <p>El objetivo principal de esta pr√°ctica ha sido desarrollar una aplicaci√≥n web <em>Full-Stack</em> capaz de controlar y monitorizar m√°quinas virtuales alojadas en VirtualBox. La aplicaci√≥n permite realizar acciones avanzadas de administraci√≥n de sistemas a trav√©s de una interfaz moderna y reactiva.</p>
            
            <h3>Funcionalidades Implementadas:</h3>
            <ul>
                <li>üìä <strong>Monitorizaci√≥n en Tiempo Real:</strong> Visualizaci√≥n de estado (Running/Paused/Stopped) y gr√°ficos de CPU/RAM.</li>
                <li>üîå <strong>Detecci√≥n Inteligente de IP:</strong> Extracci√≥n autom√°tica de la IP real de la m√°quina virtual (independientemente del adaptador de red).</li>
                <li>‚èØÔ∏è <strong>Gesti√≥n de Energ√≠a Avanzada:</strong>
                    <ul>
                        <li>Encender / Apagar (Poweroff).</li>
                        <li><strong>Pausar / Reanudar:</strong> Congela la ejecuci√≥n en RAM.</li>
                        <li><strong>Hibernar (Save State):</strong> Guarda el estado en disco persistente.</li>
                    </ul>
                </li>
                <li>üì∏ <strong>Snapshots (Copias de Seguridad):</strong> Creaci√≥n de puntos de restauraci√≥n en caliente ("Live Snapshots") desde la web.</li>
                <li>üñ•Ô∏è <strong>Integraci√≥n con Escritorio:</strong> Generaci√≥n autom√°tica de accesos directos `.desktop` universales para Linux.</li>
            </ul>
        </section>

        <section id="metodologia">
            <h2>2. Metodolog√≠a y Entorno</h2>
            <p>El desarrollo se enfrent√≥ al desaf√≠o de trabajar en un entorno Linux escolar con <strong>restricciones de permisos (sin sudo)</strong> y m√°quinas virtuales que cambian de ubicaci√≥n (USB). Se dise√±√≥ una arquitectura portable.</p>
            
            <h3>Arquitectura Portable</h3>
            <p>Se utiliz√≥ Node.js en modo portable (binarios descomprimidos) enlazados din√°micamente mediante un script <code>bash</code> que reconfigura el <code>PATH</code> en tiempo de ejecuci√≥n.</p>
            <pre>
/media/usb/proyecto
‚îú‚îÄ‚îÄ app/          # Frontend y Backend
‚îú‚îÄ‚îÄ node/         # Binarios Node.js
‚îî‚îÄ‚îÄ iniciar.sh    # Orquestador del entorno
            </pre>
        </section>

        <section id="errores">
            <h2>3. Diario de Errores (Troubleshooting)</h2>
            <p>Durante la fase final de desarrollo se encontraron problemas cr√≠ticos de comunicaci√≥n entre el servidor y el hipervisor.</p>

            <div class="troubleshooting-card">
                <div class="warn-header">üü† Error 1: IP no detectada ("---") o "undefined"</div>
                <div class="cause">
                    <strong>Causa:</strong> VirtualBox no reporta la IP si no est√°n instaladas las <em>Guest Additions</em>. Adem√°s, el comando <code>guestproperty get</code> fallaba si la IP estaba en un adaptador secundario (ej. eth1).
                </div>
                <div class="solution-body">
                    <strong>‚úÖ Soluci√≥n:</strong> 
                    <ol>
                        <li>Instalaci√≥n manual de Guest Additions en Ubuntu Server (montando ISO y compilando m√≥dulos).</li>
                        <li>Cambio en el Backend: uso de <code>guestproperty enumerate</code> + <strong>Expresi√≥n Regular (Regex)</strong> para buscar la IP en cualquier adaptador de red.</li>
                    </ol>
                </div>
            </div>

            <div class="troubleshooting-card">
                <div class="error-header">üî¥ Error 2: Rutas API no encontradas (404)</div>
                <div class="cause">
                    <strong>Causa:</strong> Al a√±adir las funcionalidades de "Pausar" y "Snapshot", la web enviaba las peticiones pero recib√≠a un 404. El servidor Node.js estaba cargado en memoria con la versi√≥n antigua del c√≥digo.
                </div>
                <div class="solution-body">
                    <strong>‚úÖ Soluci√≥n:</strong> Se estableci√≥ un protocolo de reinicio del servidor (<code>Ctrl + C</code> y relanzar script) cada vez que se modifica el archivo <code>index.js</code>.
                </div>
            </div>

            <div class="troubleshooting-card">
                <div class="warn-header">üü† Error 3: Icono de Escritorio Invisible</div>
                <div class="cause">
                    <strong>Causa:</strong> El script usaba el icono <code>utilities-system-monitor</code>, que no existe en todas las distribuciones Linux, mostrando un icono roto.
                </div>
                <div class="solution-body">
                    <strong>‚úÖ Soluci√≥n:</strong> Se modific√≥ el script <code>crear_icono.sh</code> para usar <code>utilities-terminal</code>, un icono est√°ndar presente en el 100% de los entornos Linux.
                </div>
            </div>

        </section>

        <section id="tecnica">
            <h2>4. Implementaci√≥n T√©cnica</h2>
            
            <h3>Backend: Detecci√≥n Inteligente de IP (Regex)</h3>
            <p>Para evitar errores de lectura dependiendo de la configuraci√≥n de red (NAT/Bridge), se implement√≥ una b√∫squeda basada en patrones:</p>
            <pre>
// index.js
const props = await ejecutar(`${VBOX_PATH} guestproperty enumerate "${nombre}"`);

// Regex que busca "Net/X/V4/IP" y captura el valor entre comillas o sin ellas
const ipMatch = props.match(/Net\/\d+\/V4\/IP\s*=\s*'([\d\.]+)'/);

if (ipMatch && ipMatch[1]) {
    ipAddress = ipMatch[1]; // IP Encontrada (ej: 192.168.1.50)
}
            </pre>

            <h3>Backend: Gesti√≥n de Estados y Snapshots</h3>
            <p>Se a√±adieron rutas espec√≠ficas para controlar el ciclo de vida completo de la VM.</p>
            <pre>
// Pausar (Congelar en RAM)
app.post('/api/pause/:id', async (req, res) => {
    await ejecutar(`${VBOX_PATH} controlvm "${req.params.id}" pause`);
    res.json({ status: 'ok' });
});

// Reanudar (Descongelar)
app.post('/api/resume/:id', async (req, res) => {
    await ejecutar(`${VBOX_PATH} controlvm "${req.params.id}" resume`);
    res.json({ status: 'ok' });
});

// Crear Snapshot (Backup en caliente)
app.post('/api/snapshot/take/:id', async (req, res) => {
    await ejecutar(`${VBOX_PATH} snapshot "${req.params.id}" take "Backup_Web" --live`);
    res.json({ status: 'ok' });
});
            </pre>

            <h3>Frontend: Bot√≥n de Acci√≥n Din√°mico</h3>
            <p>La interfaz cambia el comportamiento del bot√≥n principal seg√∫n el estado de la m√°quina, permitiendo "Reanudar" solo si est√° pausada.</p>
            <pre>
if (srv.estado === 'paused') {
    // Si est√° pausada, el bot√≥n se vuelve Naranja y ejecuta 'resume'
    btnMain.className = 'btn-main btn-resume';
    btnMain.innerHTML = 'REANUDAR';
    btnMain.onclick = () => sendCommand(srv.id, 'resume');
} else if (srv.estado === 'running') {
    // Si est√° corriendo, permite Apagar
    // ...
}
            </pre>
        </section>

        <section id="conclusion">
            <h2>5. Conclusi√≥n</h2>
            <p>El proyecto ha evolucionado de un simple visor de estados a un <strong>Panel de Control Completo</strong>. La integraci√≥n de funcionalidades avanzadas como los <strong>Snapshots</strong> y la <strong>Gesti√≥n de Energ√≠a</strong> convierten a esta herramienta web en una alternativa ligera y portable a la interfaz nativa de VirtualBox.</p>
            <p>Se ha verificado el correcto funcionamiento en entornos Ubuntu con m√°quinas virtuales tanto gr√°ficas como de servidor (CLI), resolviendo satisfactoriamente los retos de conectividad y detecci√≥n de red.</p>

            <footer>
                <p>Desarrollado para el Proyecto Final - 2024</p>
            </footer>
        </section>
    </main>

    <script>
        // Script para resaltar la secci√≥n activa en el men√∫
        const sections = document.querySelectorAll("section");
        const navLinks = document.querySelectorAll(".nav-link");

        window.onscroll = () => {
            let current = "";
            sections.forEach((section) => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 60) {
                    current = section.getAttribute("id");
                }
            });

            navLinks.forEach((li) => {
                li.classList.remove("active");
                if (li.getAttribute("href").includes(current)) {
                    li.classList.add("active");
                }
            });
        };
    </script>
</body>
</html>
